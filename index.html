<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Inventario de Muebles — KLL</title>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f3f4f6; }
  header { background:#111827; color:#fff; padding:16px; text-align:center; font-weight:700; }
  .container { max-width:900px; margin:20px auto; padding:10px; }
  .tabs { display:flex; gap:5px; margin-bottom:10px; }
  .tab-btn { flex:1; padding:10px; cursor:pointer; border:none; background:#fff; border-radius:5px; }
  .tab-btn.active { background:#111827; color:#fff; }
  .card { background:#fff; border-radius:8px; padding:15px; margin-bottom:15px; }
  .hidden { display:none; }
  input,button,select { width:100%; padding:8px; margin:5px 0; }
  button { background:#2563eb; color:#fff; border:none; cursor:pointer; }
  button:hover { background:#1d4ed8; }
  .label-preview { border:1px solid #000; padding:10px; width:300px; margin-top:10px; }
  .model { font-size:20px; font-weight:700; }
  .fabric { font-size:16px; margin-top:4px; }
  .date { font-size:14px; margin-top:4px; }
</style>
</head>
<body>
<header>Inventario de Muebles — KLL</header>
<div class="container">

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="registrar">Registrar</button>
    <button class="tab-btn" data-tab="inventario">Inventario</button>
    <button class="tab-btn" data-tab="etiquetas">Etiquetas</button>
  </div>

  <!-- Registrar -->
  <section id="registrar" class="card">
    <h2>Registrar producto</h2>
    <input id="newName" placeholder="Modelo (ej. Sillón Roma)">
    <input id="newFabric" placeholder="Tela (ej. Lino Beige)">
    <button onclick="generateProduct()">Generar código KLL y guardar</button>
  </section>

  <!-- Inventario -->
  <section id="inventario" class="card hidden">
    <h2>Inventario</h2>
    <input id="searchInput" placeholder="Buscar..." oninput="renderInventory()">
    <ul id="inventory"></ul>
  </section>

  <!-- Etiquetas -->
  <section id="etiquetas" class="card hidden">
    <h2>Etiquetas</h2>
    <select id="labelSelect" onchange="showPreview()"></select>
    <div id="previewWrap"></div>
    <button onclick="printSelectedLabel()">Imprimir etiqueta</button>
  </section>

</div>

<script>
let inventory = [];
let counter = 1;

function generateProduct(){
  const nombre = document.getElementById('newName').value.trim();
  const tela = document.getElementById('newFabric').value.trim();
  if(!nombre || !tela){ alert("Completa ambos campos"); return; }

  const code = "KLL-" + String(counter).padStart(4,"0");
  counter++;

  const date = new Date().toLocaleDateString();
  inventory.push({code, nombre, tela, cantidad:1, date});

  document.getElementById('newName').value="";
  document.getElementById('newFabric').value="";

  renderInventory();
  refreshLabelSelect();
  alert("Producto registrado con código " + code);
}

function renderInventory(){
  const q = document.getElementById('searchInput').value.toLowerCase();
  const list = document.getElementById('inventory');
  list.innerHTML="";
  inventory.filter(i => !q || i.nombre.toLowerCase().includes(q) || i.tela.toLowerCase().includes(q) || i.code.toLowerCase().includes(q))
           .forEach(i=>{
    const li = document.createElement("li");
    li.textContent = `${i.nombre} - Tela: ${i.tela} - Código: ${i.code} - Cantidad: ${i.cantidad} - Fecha: ${i.date}`;
    list.appendChild(li);
  });
}

function refreshLabelSelect(){
  const sel = document.getElementById('labelSelect');
  sel.innerHTML="";
  inventory.forEach(i=>{
    const opt = document.createElement("option");
    opt.value=i.code;
    opt.textContent = `${i.nombre} - ${i.tela}`;
    sel.appendChild(opt);
  });
  showPreview();
}

function showPreview(){
  const sel = document.getElementById('labelSelect');
  const wrap = document.getElementById('previewWrap');
  wrap.innerHTML="";
  if(!sel.value) return;
  const item = inventory.find(i=>i.code===sel.value);
  const div = document.createElement("div");
  div.className="label-preview";
  div.innerHTML = `
    <div class="model">${item.nombre}</div>
    <div class="fabric">${item.tela}</div>
    <div class="date">${item.date}</div>
    <svg id="barcode"></svg>
  `;
  wrap.appendChild(div);
  JsBarcode("#barcode", item.code, {format:"CODE128", width:2, height:60, displayValue:true});
}

function printSelectedLabel(){
  const sel = document.getElementById('labelSelect');
  if(!sel.value){ alert("Selecciona un producto"); return; }
  const item = inventory.find(i=>i.code===sel.value);
  const w = window.open('', '', 'width=400,height=300');
  w.document.write(`
    <html><head><title>Etiqueta</title>
    <style>
      body{font-family:Arial; text-align:center; padding:20px;}
      .model{font-size:20px;font-weight:700}
      .fabric{font-size:16px;margin-top:4px}
      .date{font-size:14px;margin-top:4px}
    </style>
    </head><body>
      <div class="model">${item.nombre}</div>
      <div class="fabric">${item.tela}</div>
      <div class="date">${item.date}</div>
      <svg id="b"></svg>
      <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"><\/script>
      <script>
        JsBarcode("#b","${item.code}",{format:"CODE128",width:2,height:60,displayValue:true});
        window.onload=function(){window.print();}
      <\/script>
    </body></html>
  `);
  w.document.close();
}

/* Tabs */
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));
    document.getElementById(btn.dataset.tab).classList.remove('hidden');
  });
});
</script>
</body>
</html>