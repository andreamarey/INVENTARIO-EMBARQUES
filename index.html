<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario de Muebles con Código de Barras</title>

<!-- Librerías -->
<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<style>
body { font-family: Arial; padding: 20px; background:#f4f4f4; }
header { text-align:center; background:#007bff; color:white; padding:15px; border-radius:8px; margin-bottom:20px; }
.card { background:white; padding:20px; border-radius:10px; margin-bottom:20px; box-shadow:0 2px 6px rgba(0,0,0,0.1); max-width:700px; margin:auto; }
input, button, select { width:100%; padding:10px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
button { background:#007bff; color:white; border:none; cursor:pointer; }
button:hover { background:#0056b3; }
ul { padding:0; list-style:none; }
li { padding:10px; border-bottom:1px solid #eee; }
.barcode { margin-top:10px; text-align:center; }
</style>
</head>
<body>

<header><h1>Inventario de Muebles</h1></header>

<!-- Pestaña: Generador de Códigos -->
<div class="card">
<h2>Generador de Códigos de Barras</h2>
<input type="text" id="newName" placeholder="Nombre del mueble">
<input type="text" id="newColor" placeholder="Tela/Color">
<button onclick="generateProduct()">Generar código y agregar al inventario</button>

<div class="barcode">
<svg id="barcodeSvg"></svg>
</div>
</div>

<!-- Pestaña: Escáner -->
<div class="card">
<h2>Escanear Código</h2>
<div id="reader" style="width:100%; max-width:400px; margin:auto;"></div>
</div>

<!-- Pestaña: Inventario -->
<div class="card">
<h2>Inventario</h2>
<label>Filtrar por mes:</label>
<input type="month" id="filterMonth" onchange="updateInventoryList()">
<ul id="inventory"></ul>
<button onclick="downloadCSV()">Descargar CSV</button>
</div>

<script>
let productos = {}; // Diccionario de productos
let inventory = []; // Inventario actual

// Generador de producto con código único
function generateProduct(){
    const name = document.getElementById('newName').value;
    const color = document.getElementById('newColor').value;
    if(!name || !color){ alert("Ingresa nombre y color"); return; }
    
    const code = "MUEB-" + Date.now(); // código único
    productos[code] = {nombre:name, color:color};

    // Mostrar código de barras
    JsBarcode("#barcodeSvg", code, {format:"CODE128", displayValue:true, fontSize:16});
    
    // Agregar al inventario con fecha actual
    inventory.push({barcode:code, nombre:name, color:color, date:new Date()});

    // Limpiar inputs
    document.getElementById('newName').value="";
    document.getElementById('newColor').value="";

    updateInventoryList();
}

// Escáner de códigos
function onScanSuccess(decodedText){
    document.getElementById('barcodeInput')?.value = decodedText;
    if(productos[decodedText]){
        const prod = productos[decodedText];
        alert(`Producto: ${prod.nombre}\nColor: ${prod.color}`);
    } else {
        alert("Producto no registrado");
    }
}

let scanner = new Html5QrcodeScanner("reader", { fps:10, qrbox:250 });
scanner.render(onScanSuccess);

// Actualizar lista de inventario
function updateInventoryList(){
    const list = document.getElementById('inventory');
    list.innerHTML="";
    const filter = document.getElementById('filterMonth').value;
    
    inventory.forEach(item=>{
        let itemMonth = item.date.toISOString().slice(0,7); // YYYY-MM
        if(!filter || itemMonth===filter){
            const li = document.createElement('li');
            li.textContent=`${item.nombre} - Color: ${item.color} - Código: ${item.barcode} - Fecha: ${item.date.toLocaleDateString()}`;
            list.appendChild(li);
        }
    });
}

// Descargar CSV
function downloadCSV(){
    let csv = "codigo,nombre,color,fecha\n";
    inventory.forEach(item=>{
        csv += `${item.barcode},${item.nombre},${item.color},${item.date.toLocaleDateString()}\n`;
    });
    const blob = new Blob([csv], {type: 'text/csv'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `inventario_${new Date().toISOString().slice(0,10)}.csv`;
    link.click();
}
</script>

</body>
</html>
